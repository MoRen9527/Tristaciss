# ðŸš€ ä¸‰å…ƒæ˜ŸçƒåŸŽå¸‚ç©ºé—´ç«™éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## ðŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

æˆ‘ä¸ºæ‚¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ47.245.122.61ï¼‰è®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„Dockerå®¹å™¨åŒ–è‡ªåŠ¨éƒ¨ç½²æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### âœ¨ æ ¸å¿ƒä¼˜åŠ¿
- **ðŸ”„ ä¸€é”®éƒ¨ç½²**ï¼šå…¨è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- **ðŸ“¦ å®¹å™¨åŒ–**ï¼šDocker + Docker Composeï¼ŒçŽ¯å¢ƒéš”ç¦»ï¼Œæ˜“äºŽç®¡ç†
- **ðŸŒ åå‘ä»£ç†**ï¼šNginxç»Ÿä¸€å…¥å£ï¼Œå¤„ç†é™æ€æ–‡ä»¶å’ŒAPIè·¯ç”±
- **ðŸ› ï¸ æ™ºèƒ½è¿ç»´**ï¼šè‡ªåŠ¨ç›‘æŽ§ã€æ—¥å¿—ç®¡ç†ã€å¥åº·æ£€æŸ¥
- **ðŸ”§ ä¾¿äºŽç»´æŠ¤**ï¼šæ ‡å‡†åŒ–éƒ¨ç½²ï¼Œæ”¯æŒå¿«é€Ÿæ›´æ–°å’Œå›žæ»š

## ðŸ—ï¸ æž¶æž„è®¾è®¡

```
Internet (47.245.122.61)
         â†“
    Nginx (Port 80/443)
    â”œâ”€â”€ / â†’ Reactå‰ç«¯ (é™æ€æ–‡ä»¶)
    â”œâ”€â”€ /api â†’ FastAPIåŽç«¯ (Port 8008)
    â””â”€â”€ /ws â†’ WebSocketè¿žæŽ¥
         â†“
    Dockerå®¹å™¨é›†ç¾¤
    â”œâ”€â”€ frontend (Nginx + React)
    â””â”€â”€ backend (Python + FastAPI)
```

## ðŸ“ éƒ¨ç½²æ–‡ä»¶æ¸…å•

æˆ‘å·²ä¸ºæ‚¨åˆ›å»ºäº†ä»¥ä¸‹éƒ¨ç½²æ–‡ä»¶ï¼š

### ðŸ³ Dockeré…ç½®
- `Dockerfile.backend` - åŽç«¯å®¹å™¨é…ç½®
- `Dockerfile.frontend` - å‰ç«¯å®¹å™¨é…ç½®  
- `docker-compose.yml` - æœåŠ¡ç¼–æŽ’é…ç½®
- `nginx.conf` - Nginxåå‘ä»£ç†é…ç½®

### ðŸš€ è‡ªåŠ¨åŒ–è„šæœ¬
- `deploy.sh` - ä¸»éƒ¨ç½²è„šæœ¬ï¼ˆå®Œæ•´éƒ¨ç½²æµç¨‹ï¼‰
- `quick-deploy.sh` - ä¸€é”®å¿«é€Ÿéƒ¨ç½²è„šæœ¬
- `update.sh` - é¡¹ç›®æ›´æ–°è„šæœ¬
- `monitor.sh` - æœåŠ¡ç›‘æŽ§è„šæœ¬
- `pre-deploy-check.sh` - éƒ¨ç½²å‰çŽ¯å¢ƒæ£€æŸ¥

### ðŸ“š æ–‡æ¡£æŒ‡å—
- `README_DEPLOYMENT.md` - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- `server-setup.md` - æœåŠ¡å™¨é…ç½®æŒ‡å—
- `ä¸‰å…ƒé¡¹ç›®éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“.md` - æœ¬æ–‡æ¡£ï¼ˆæ–¹æ¡ˆæ€»ç»“ï¼‰

## ðŸŽ¯ éƒ¨ç½²æ­¥éª¤ï¼ˆä¸‰ç§æ–¹å¼ï¼‰

### æ–¹å¼ä¸€ï¼šGitå…‹éš†éƒ¨ç½²ï¼ˆæŽ¨èï¼‰
```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh root@47.245.122.61

# 2. å…‹éš†é¡¹ç›®ä»£ç ï¼ˆè‡ªåŠ¨æŽ’é™¤åžƒåœ¾æ–‡ä»¶ï¼‰
cd /opt
git clone https://github.com/MoRen9527/Tristaciss.git tristaciss
cd tristaciss

# 3. ä¸€é”®éƒ¨ç½²
chmod +x quick-deploy.sh
./quick-deploy.sh
```

### æ–¹å¼äºŒï¼šé€‰æ‹©æ€§æ–‡ä»¶ä¸Šä¼ ï¼ˆæ‰‹åŠ¨æŽ§åˆ¶ï¼‰
```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh root@47.245.122.61
cd /opt && mkdir tristaciss && cd tristaciss

# 2. åªä¸Šä¼ å¿…è¦çš„é¡¹ç›®æ–‡ä»¶
# ä¸Šä¼ åŽç«¯ä»£ç 
scp -r ./api-server root@47.245.122.61:/opt/tristaciss/
# ä¸Šä¼ å‰ç«¯ä»£ç 
scp -r ./avatar-react root@47.245.122.61:/opt/tristaciss/
# ä¸Šä¼ éƒ¨ç½²è„šæœ¬
scp ./deploy.sh ./quick-deploy.sh ./docker-compose.yml root@47.245.122.61:/opt/tristaciss/
scp ./Dockerfile.* ./nginx.conf root@47.245.122.61:/opt/tristaciss/

# 3. æ‰§è¡Œéƒ¨ç½²
chmod +x deploy.sh
./deploy.sh
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨rsyncæ™ºèƒ½åŒæ­¥ï¼ˆæŽ¨èç”Ÿäº§çŽ¯å¢ƒï¼‰
```bash
# 1. åˆ›å»ºéƒ¨ç½²æŽ’é™¤æ–‡ä»¶ï¼ˆåœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ï¼‰
cat > .deployignore << 'EOF'
node_modules/
.git/
.vscode/
.idea/
__pycache__/
*.pyc
*.pyo
.env.local
.env.development
*.log
.DS_Store
Thumbs.db
coverage/
.nyc_output/
dist/
build/
.cache/
.temp/
*.tmp
.pytest_cache/
.coverage
bug_records/
docs/development/
*.md
!README.md
!README_DEPLOYMENT.md
EOF

# 2. ä½¿ç”¨rsyncåŒæ­¥ï¼ˆè‡ªåŠ¨æŽ’é™¤åžƒåœ¾æ–‡ä»¶ï¼‰
rsync -avz --exclude-from='.deployignore' \
  --delete \
  ./ root@47.245.122.61:/opt/tristaciss/

# 3. ç™»å½•æœåŠ¡å™¨æ‰§è¡Œéƒ¨ç½²
ssh root@47.245.122.61 "cd /opt/tristaciss && chmod +x deploy.sh && ./deploy.sh"
```

### æ–¹å¼å››ï¼šDockeræž„å»ºéƒ¨ç½²ï¼ˆæœ€å®‰å…¨ï¼‰
```bash
# 1. æœ¬åœ°æž„å»ºDockeré•œåƒï¼ˆåªåŒ…å«å¿…è¦æ–‡ä»¶ï¼‰
docker build -f Dockerfile.backend -t tristaciss-backend ./api-server
docker build -f Dockerfile.frontend -t tristaciss-frontend ./avatar-react

# 2. æŽ¨é€åˆ°é•œåƒä»“åº“
docker tag tristaciss-backend your-registry/tristaciss-backend:latest
docker tag tristaciss-frontend your-registry/tristaciss-frontend:latest
docker push your-registry/tristaciss-backend:latest
docker push your-registry/tristaciss-frontend:latest

# 3. æœåŠ¡å™¨æ‹‰å–å¹¶éƒ¨ç½²
ssh root@47.245.122.61 "docker pull your-registry/tristaciss-backend:latest && docker pull your-registry/tristaciss-frontend:latest && cd /opt/tristaciss && docker-compose up -d"
```

## âš™ï¸ çŽ¯å¢ƒé…ç½®

### åŽç«¯é…ç½® (api-server/.env)
```env
API_HOST=0.0.0.0
API_PORT=8008
DEBUG=false
DATABASE_URL=sqlite:///./chat_history.db
CORS_ORIGINS=["*"]
```

### å‰ç«¯é…ç½® (avatar-react/.env.production)
```env
VITE_API_BASE_URL=/api
VITE_WS_URL=/ws
VITE_NODE_ENV=production
```

## ðŸ”§ æ—¥å¸¸ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°éƒ¨ç½²
./update.sh
```

### ç›‘æŽ§ç®¡ç†
```bash
# è¿è¡Œç›‘æŽ§é¢æ¿
./monitor.sh

# å¿«é€Ÿé‡å¯
./restart.sh

# æŸ¥çœ‹æ—¥å¿—
./logs.sh
```

## ðŸ“Š éƒ¨ç½²åŽéªŒè¯

éƒ¨ç½²å®ŒæˆåŽï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

### ðŸŒ è®¿é—®æµ‹è¯•
- **å‰ç«¯é¡µé¢**ï¼šhttp://47.245.122.61
- **APIæŽ¥å£**ï¼šhttp://47.245.122.61/api
- **å¥åº·æ£€æŸ¥**ï¼šhttp://47.245.122.61/health

### ðŸ” çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥æœåŠ¡å“åº”
curl http://47.245.122.61/health
curl http://47.245.122.61/api/health
```

## ðŸ›¡ï¸ å®‰å…¨éƒ¨ç½²æœ€ä½³å®žè·µ

### ðŸš« é¿å…ä¸Šä¼ æ•æ„Ÿæ–‡ä»¶
é¡¹ç›®å·²åŒ…å« `.deployignore` æ–‡ä»¶ï¼Œè‡ªåŠ¨æŽ’é™¤ï¼š
- ðŸ”’ **æ•æ„Ÿé…ç½®**ï¼š`.env.local`, `.env.development` ç­‰
- ðŸ“¦ **ä¾èµ–ç›®å½•**ï¼š`node_modules/`, `.venv/`, `__pycache__/` ç­‰  
- ðŸ—‚ï¸ **å¼€å‘æ–‡ä»¶**ï¼š`.git/`, `.vscode/`, `bug_records/` ç­‰
- ðŸ“ **æ—¥å¿—ç¼“å­˜**ï¼š`*.log`, `cache/`, `.temp/` ç­‰

### ðŸŽ¯ æŽ¨èéƒ¨ç½²æ–¹å¼ä¼˜å…ˆçº§
1. **ðŸ¥‡ Gitå…‹éš†** - æœ€å®‰å…¨ï¼Œè‡ªåŠ¨ç‰ˆæœ¬æŽ§åˆ¶
2. **ðŸ¥ˆ rsyncåŒæ­¥** - æ™ºèƒ½æŽ’é™¤ï¼Œå¢žé‡æ›´æ–°  
3. **ðŸ¥‰ Dockeré•œåƒ** - å®Œå…¨éš”ç¦»ï¼Œç”Ÿäº§çº§åˆ«
4. **âš ï¸ æ‰‹åŠ¨ä¸Šä¼ ** - ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨

### ðŸ”§ ä½¿ç”¨å®‰å…¨éƒ¨ç½²è„šæœ¬
```bash
# ä¸€é”®å®‰å…¨éƒ¨ç½²ï¼ˆæŽ¨èï¼‰
chmod +x deploy-safe.sh
./deploy-safe.sh
```

### é˜²ç«å¢™é…ç½®
```bash
# å¼€æ”¾å¿…è¦ç«¯å£
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --reload
```

### SSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰
```bash
# å®‰è£…Let's Encryptè¯ä¹¦
yum install -y certbot python3-certbot-nginx
certbot --nginx -d yourdomain.com
```

### æ€§èƒ½ä¼˜åŒ–
- Dockeré•œåƒåŠ é€Ÿå™¨é…ç½®
- Nginx gzipåŽ‹ç¼©
- é™æ€æ–‡ä»¶ç¼“å­˜
- æ—¥å¿—è½®è½¬

## ðŸš¨ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜
1. **ç«¯å£è¢«å ç”¨** â†’ æ£€æŸ¥å¹¶åœæ­¢å ç”¨è¿›ç¨‹
2. **å®¹å™¨å¯åŠ¨å¤±è´¥** â†’ æŸ¥çœ‹æ—¥å¿—æŽ’æŸ¥é”™è¯¯
3. **ç½‘ç»œè¿žæŽ¥é—®é¢˜** â†’ æ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„
4. **èµ„æºä¸è¶³** â†’ å‡çº§æœåŠ¡å™¨é…ç½®

### ç´§æ€¥æ¢å¤
```bash
# å¿«é€Ÿé‡ç½®
docker-compose down
docker system prune -f
docker-compose up -d --build
```

## ðŸ“ˆ åŽç»­æ‰©å±•

### é«˜å¯ç”¨éƒ¨ç½²
- è´Ÿè½½å‡è¡¡é…ç½®
- æ•°æ®åº“é›†ç¾¤
- Redisç¼“å­˜
- å®¹å™¨ç¼–æŽ’ï¼ˆKubernetesï¼‰

### CI/CDé›†æˆ
- GitHub Actionsè‡ªåŠ¨éƒ¨ç½²
- ä»£ç è´¨é‡æ£€æŸ¥
- è‡ªåŠ¨åŒ–æµ‹è¯•
- æ»šåŠ¨æ›´æ–°

## ðŸ’¡ æœ€ä½³å®žè·µå»ºè®®

1. **å®šæœŸå¤‡ä»½**ï¼šæ•°æ®åº“å’Œé…ç½®æ–‡ä»¶
2. **ç›‘æŽ§å‘Šè­¦**ï¼šè®¾ç½®æœåŠ¡ç›‘æŽ§å’Œå‘Šè­¦
3. **æ—¥å¿—ç®¡ç†**ï¼šå®šæœŸæ¸…ç†å’Œå½’æ¡£æ—¥å¿—
4. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–
5. **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®

## ðŸŽ‰ éƒ¨ç½²å®ŒæˆåŽ

éƒ¨ç½²æˆåŠŸåŽï¼Œæ‚¨å°†èŽ·å¾—ï¼š
- âœ… å®Œå…¨å®¹å™¨åŒ–çš„åº”ç”¨çŽ¯å¢ƒ
- âœ… è‡ªåŠ¨åŒ–çš„è¿ç»´ç®¡ç†å·¥å…·
- âœ… å®Œæ•´çš„ç›‘æŽ§å’Œæ—¥å¿—ç³»ç»Ÿ
- âœ… ä¾¿äºŽç»´æŠ¤å’Œæ‰©å±•çš„æž¶æž„
- âœ… ç”Ÿäº§çº§åˆ«çš„éƒ¨ç½²æ–¹æ¡ˆ

---

**ðŸ”¥ ç«‹å³å¼€å§‹å®‰å…¨éƒ¨ç½²ï¼š**

### ðŸš€ é¦–æ¬¡åˆå§‹åŒ–ï¼ˆåˆ›å»ºGitHubä»“åº“ï¼‰
```bash
# Windowsç”¨æˆ·
init-repo.bat your-github-username

# Linux/Macç”¨æˆ·  
./init-repo.sh your-github-username
```

### ðŸ“¤ æ›´æ–°ä»£ç åˆ°ä»“åº“
```bash
# Windowsç”¨æˆ·
update-repo.bat "æ›´æ–°è¯´æ˜Ž"

# Linux/Macç”¨æˆ·
./update-repo.sh "æ›´æ–°è¯´æ˜Ž"
```

### ðŸ³ éƒ¨ç½²åˆ°æœåŠ¡å™¨
1. æ£€æŸ¥ `.deployignore` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æ‰§è¡Œ `./deploy-safe.sh` ï¼ˆæŽ¨èï¼‰
3. æˆ–ä½¿ç”¨ Git å…‹éš†: `git clone https://github.com/your-username/Tristaciss.git`
4. ç­‰å¾…éƒ¨ç½²å®Œæˆ
5. è®¿é—® http://47.245.122.61 éªŒè¯

**âš ï¸ å®‰å…¨æé†’ï¼š**
- âŒ é¿å…ä½¿ç”¨ `scp -r ./tristaciss/*` ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
- âœ… ä½¿ç”¨ Gitã€rsync æˆ–å®‰å…¨éƒ¨ç½²è„šæœ¬
- ðŸ”’ ç¡®ä¿æ•æ„Ÿæ–‡ä»¶ä¸ä¼šè¢«ä¸Šä¼ åˆ°æœåŠ¡å™¨

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒï¼