# 🔐 Tristaciss 用户权限部署指南

## 🎯 快速答案

**建议创建非root用户，但该用户需要有sudo权限！**

## 📋 完整部署步骤

### 方式一：创建新用户（推荐）

#### 1. 创建部署用户
```bash
# 以root身份登录服务器后执行
ssh root@47.245.122.61

# 创建新用户（例如：deploy）
adduser deploy

# 设置密码
passwd deploy

# 将用户添加到sudo组
usermod -aG sudo deploy  # Ubuntu/Debian
# 或者
usermod -aG wheel deploy # CentOS/RHEL
```

#### 2. 切换到新用户部署
```bash
# 切换到新用户
su - deploy

# 执行一键部署
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
```

### 方式二：使用root用户（简单但不推荐）

```bash
# 直接以root身份运行（脚本会警告但允许继续）
ssh root@47.245.122.61
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
# 当提示时输入 'y' 继续
```

## 🔍 为什么需要sudo权限？

### 脚本需要执行的操作：
1. **系统更新** - `sudo apt update`
2. **安装软件包** - `sudo apt install docker`
3. **配置防火墙** - `sudo ufw allow 80`
4. **创建目录** - `sudo mkdir -p /opt`
5. **启动服务** - `sudo systemctl start docker`
6. **用户组管理** - `sudo usermod -aG docker $USER`

## 🛡️ 安全最佳实践

### ✅ 推荐做法：
```bash
# 1. 创建专用部署用户
adduser tristaciss-deploy
passwd tristaciss-deploy
usermod -aG sudo tristaciss-deploy

# 2. 使用该用户部署
su - tristaciss-deploy
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
```

### ❌ 不推荐：
- 直接用root用户运行（安全风险）
- 使用没有sudo权限的普通用户（会失败）

## 🚀 一键创建用户脚本

为了方便，我为您准备了一键创建部署用户的脚本：

```bash
# 以root身份运行此脚本创建部署用户
cat > create-deploy-user.sh << 'EOF'
#!/bin/bash

echo "🔐 创建Tristaciss部署用户..."

# 创建用户
adduser --disabled-password --gecos "" tristaciss-deploy

# 设置密码
echo "请为部署用户设置密码："
passwd tristaciss-deploy

# 添加sudo权限
if command -v usermod &> /dev/null; then
    # Ubuntu/Debian
    usermod -aG sudo tristaciss-deploy 2>/dev/null || \
    # CentOS/RHEL
    usermod -aG wheel tristaciss-deploy
fi

echo "✅ 部署用户创建完成！"
echo "现在可以使用以下命令切换用户并部署："
echo "su - tristaciss-deploy"
echo "curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash"
EOF

chmod +x create-deploy-user.sh
./create-deploy-user.sh
```

## 📝 完整部署流程示例

### 场景：全新服务器部署

```bash
# 1. 以root身份登录
ssh root@47.245.122.61

# 2. 创建部署用户
adduser deploy
passwd deploy
usermod -aG sudo deploy

# 3. 切换到部署用户
su - deploy

# 4. 执行一键部署
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash

# 5. 部署完成后访问
# http://47.245.122.61
```

## ❓ 常见问题解答

### Q1: 我必须创建新用户吗？
**A:** 不是必须的，但强烈推荐。可以用root运行，但脚本会警告。

### Q2: 为什么不能用普通用户？
**A:** 因为需要安装软件、配置系统，必须有sudo权限。

### Q3: 用root用户有什么风险？
**A:** 
- 安全风险更高
- 文件权限可能混乱
- 不符合最佳实践

### Q4: 如果我已经有其他用户怎么办？
**A:** 确保该用户有sudo权限即可：
```bash
# 检查用户是否有sudo权限
sudo -l

# 如果没有，用root添加：
usermod -aG sudo 用户名
```

## 🎯 最简单的部署方式

### 对于小白用户：

#### 选项1：安全方式（推荐）
```bash
# 1. 以root登录
ssh root@47.245.122.61

# 2. 一键创建用户并部署
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
# 脚本会提示是否继续，输入 'n'，然后：

adduser deploy && usermod -aG sudo deploy
su - deploy
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
```

#### 选项2：快速方式（简单但不推荐）
```bash
# 直接用root运行，当提示时输入 'y'
ssh root@47.245.122.61
curl -fsSL https://raw.githubusercontent.com/MoRen9527/Tristaciss/main/quick-deploy.sh | bash
```

## 🎉 总结

**最佳实践**：创建有sudo权限的非root用户来运行部署脚本。

**快速方案**：直接用root运行，但要承担安全风险。

**记住**：无论哪种方式，脚本都会自动处理所有技术细节！🚀