# 三元星球城市空间站 - AI应用生产制造平台 (Tristaciss)

## 📋 产品概述

### 产品名称
**Tristaciss** - 三元星球城市空间站

### 产品愿景
打造一个三元宇宙的入口，用户成为三元宇宙原住民的前站，进入空间站，空间能够学习用户特征（声音、外貌）、模拟用户思维、制造数字分身（avatar），协助用户处理各类任务。通过赛博协作的方式，让数字分身成为用户在三元宇宙虚拟世界中的赛博投影，即三元宇宙原住民。

### 核心价值
- **个性化学习**：深度学习用户的声音、外貌、行为模式和知识储备
- **智能协作**：与用户共同规划和执行各类生活、工作任务
- **可视化规划**：通过赛博大脑图形化展示任务分解和执行计划
- **沉浸式交互**：基于Unreal Engine的3D数字人提供与赛博自己的交互体验

---

## 🎯 核心概念定义

### 数字分身 (Digital Avatar)
- **不是**传统的AI助手，而是用户的数字真身
- 通过持续学习逐渐具备用户的：
  - 声音特征和语言习惯
  - 思维逻辑和决策模式
  - 专业知识和技能储备
  - 行为偏好和价值观念

### 协作模式
- **双向学习**：分身学习用户特征和行为模式，用户学习分身更高级的思维模式和更丰富的知识储备
- **任务共担**：复杂任务由人机协作完成
- **决策协商**：重要决策通过交互确认达成一致

---

## 🚀 功能需求详述

### 1. 数字分身核心功能

#### 1.1 个性化学习系统
- **声音克隆**
  - 采集用户语音样本
  - 训练个性化TTS模型
  - 支持情感表达和语调变化

- **外貌与外形克隆**
  - 采集用户外貌特征
  - 训练个性化3d人脸及身体建模
  - 支持游戏角色
  - 支持直播短视频制作
  - 支持虚拟现实


- **行为模式学习**
  - 记录用户的决策偏好
  - 分析用户的工作习惯
  - 学习用户的沟通风格

- **知识图谱构建**
  - 从对话中提取用户专业知识
  - 构建个人知识库
  - 支持知识的增量学习

#### 1.2 智能交互能力
- **多模态交互**
  - 语音对话（基于语音电话）
  - 文字沟通（基于文字或者语音转文字）
  - 表情和肢体语言（Unreal数字人）
  - 情感表达

- **上下文理解**
  - 长期记忆管理
  - 情境感知能力
  - 个性化回应生成

### 2. 任务规划与管理系统

#### 2.1 智能任务分解
- **需求理解**
  - 自然语言任务描述解析
  - 目标识别和优先级判断
  - 约束条件分析

- **任务分解策略**
  - 递归式任务拆分
  - 依赖关系识别
  - 资源需求评估
  - 时间规划建议

#### 2.2 可视化工作流设计

**参考n8n/Dify模式设计：**

- **节点类型**
  ```
  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
  │   开始节点   │ -> │   任务节点   │ -> │   决策节点   │
  └─────────────┘    └─────────────┘    └─────────────┘
        │                   │                   │
        v                   v                   v
  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
  │   等待节点   │    │   工具节点   │    │   结束节点   │
  └─────────────┘    └─────────────┘    └─────────────┘
  ```

- **节点功能**
  - **任务节点**：具体执行步骤
  - **决策节点**：需要用户确认的分支点
  - **工具节点**：调用外部API或工具
  - **等待节点**：等待外部条件或用户输入
  - **并行节点**：支持任务并行执行

- **工作流编辑器**
  - 拖拽式节点添加
  - 连线表示流程关系
  - 实时预览和验证
  - 版本管理和回滚

#### 2.3 外部工具集成
- **API集成框架**
  - MCP 集成
  - 邮件服务 (Email APIs)
  - 日历管理 (Calendar APIs)
  - 文档处理 (Office 365, Google Workspace)
  - 项目管理 (Jira, Trello, Notion)
  - 通讯工具 (Slack, Teams, 微信)
  - 财务工具 (Xero, QuickBooks)
  - 社交工具 (Facebook, Twitter, LinkedIn)
  - 媒体工具 (YouTube, Spotify)
  - 量化交易


- **自定义工具开发**
  - 插件开发框架
  - Webhook支持
  - 脚本执行环境

### 3. 用户界面设计

#### 3.1 整体布局 

---

## 🚀 第一阶段实施方案 (MVP)

### 🎯 阶段目标1
实现基本的AI对话，实现基于关键词检测的信息卡管理功能，演示数字分身协作的核心概念。

### ✅ 第一阶段功能范围

#### 1. 界面框架
- [x] 左右分栏布局设计
- [x] 左侧：聊天功能
- [x] 右侧：赛博大脑，基于左侧的关键词动态显示对应的信息卡
- [x] 顶部导航栏：左侧放置logo和产品名称，右侧是用户头像

#### 2. 信息卡管理
- [x] 基于关键词检测创建并显示在右侧赛博大脑中
- [x] 新信息卡始终在赛博大脑所有卡牌的顶部
- [x] 基本任务状态管理
- [x] 基础交互按钮

### 🛠️ 技术实现方案

#### 前端技术栈
- React 18 + Material-UI 5
- Redux Toolkit 状态管理
- WebSocket 实时通信
- 响应式设计和动态信息卡组件

#### 后端技术栈
- FastAPI + Python 3.9+
- SQLite/PostgreSQL 数据库
- WebSocket 支持
- RESTful API 设计

#### 演示数据
- 预设几个信息卡
- 测试用户交互流程

---

## 🚀 第二阶段实施方案 - 多模型智能聊天系统

### 🎯 阶段目标2
在现有聊天系统基础上，实现多模型选择、切换和群聊功能，通过统一的API代理层支持不同的AI服务提供商，为用户提供更加灵活和强大的AI交互体验。

### ✅ 第二阶段功能范围

#### 1. API代理层架构 (P0优先级)

**统一API接口设计**
- 实现ModelProvider抽象基类
- 支持OpenAI、OpenRouter、Anthropic等多种提供商
- 统一的配置管理和错误处理
- 热切换API提供商，无需重启服务

**多提供商支持**
```python
# 支持的API提供商类型
providers = {
    "openai": "标准OpenAI SDK调用方式",
    "openrouter": "当前使用的OpenRouter API", 
    "anthropic": "Claude模型支持",
    "custom": "用户自定义API endpoint"
}
```

**配置管理系统**
- 加密存储用户API密钥
- 支持多套配置并发使用
- 实时配置验证和连接测试

#### 2. 聊天界面微调改造 (P1优先级)

**模型选择功能**
在现有ChatPanel组件上方添加模式切换和模型选择：
```
┌─────────────────────────────────────────────────────┐
│ [单聊 ●] [群聊 ○] | 模型: [GPT-4 ▼] | [设置⚙️]     │
└─────────────────────────────────────────────────────┘
```

**群聊模式界面增强**
- 支持同时与2个以上AI模型对话
- 消息来源清晰标识，避免混淆
- 实时显示各模型响应状态和时间

**赛博大脑界面增强**
在现有的赛博大脑中动态显示：
- 当前参与模型的状态监控
- 模型响应时间和性能统计  
- Token使用情况和成本分析

#### 3. 用户配置系统 (P2优先级)

**模型配置管理界面**
- API密钥安全配置和管理
- 自定义模型添加和测试
- 模型特性标签和分类管理

**智能对话策略配置**
- 话题分类和模型优先级设置
- 群聊回复策略选择：
  - 并发模式：所有模型同时回复
  - 序列模式：按优先级顺序回复
  - 智能分发：根据问题类型自动选择

**对话增强功能**
- 支持@模型名指定特定模型回复
- 支持#讨论标签开启多模型讨论
- 支持#比较标签获取不同观点对比

#### 4. 实时通信升级 (P1优先级)

**WebSocket群聊架构**
- 实现并发多模型响应处理
- 消息队列管理和状态同步
- 错误隔离：单个模型失败不影响其他

**消息分发机制**
- 智能话题识别和模型分配
- 响应时间优化和缓存策略
- 实时状态更新和进度显示

### 🛠️ 技术实现计划

#### Phase 1: API代理层基础架构 (1周)
- [ ] 重构现有OpenRouter调用为统一Provider模式
- [ ] 实现OpenAI SDK Provider支持
- [ ] 添加Provider配置管理API端点
- [ ] 单模型切换功能测试验证

**验收标准：**
- 支持OpenAI和OpenRouter等API SDK在代理层无缝切换
- 统一错误处理和响应格式
- 配置热更新不影响现有会话

#### Phase 2: 单聊模式增强 (3天)
- [ ] ChatPanel组件添加模型选择器
- [ ] 实现模型状态显示和切换逻辑
- [ ] 集成赛博大脑的模型监控
- [ ] 多种模型响应效果测试

**验收标准：**
- 模型切换响应时间<200ms
- 界面布局不破坏现有设计
- 模型状态实时准确显示

#### Phase 3: 群聊模式核心功能 (1周)  
- [ ] 实现WebSocket群聊消息分发架构
- [ ] 群聊模式UI切换和多模型管理
- [ ] 并发响应处理和消息队列优化
- [ ] 群聊交互体验测试和优化

**验收标准：**
- 支持选择任意2个以上模型同时参与对话
- 消息来源识别清晰无歧义
- 群聊响应总时间控制在合理范围

#### Phase 4: 配置系统和体验优化 (3天)
- [ ] 模型配置界面开发和集成
- [ ] API密钥安全存储和管理
- [ ] 对话策略配置功能实现
- [ ] 整体功能测试和性能调优

**验收标准：**
- 配置界面友好易用
- API密钥安全加密存储
- 用户配置持久化保存
- 整体系统稳定可靠

### 📊 数据库设计扩展

#### 用户配置相关表结构
```sql
-- 用户模型配置表
CREATE TABLE user_ai_models (
    id VARCHAR(50) PRIMARY KEY,
    user_id VARCHAR(50) REFERENCES users(id),
    provider_type VARCHAR(50) NOT NULL, -- 'openai', 'openrouter', 'custom'
    model_name VARCHAR(100) NOT NULL,
    api_key_encrypted TEXT NOT NULL,
    api_config JSON, -- 存储额外配置参数
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 对话策略配置表
CREATE TABLE chat_strategies (
    id VARCHAR(50) PRIMARY KEY,
    user_id VARCHAR(50) REFERENCES users(id),
    strategy_name VARCHAR(100) NOT NULL,
    strategy_config JSON NOT NULL, -- 存储策略详细配置
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 群聊会话管理表
CREATE TABLE group_chat_sessions (
    id VARCHAR(50) PRIMARY KEY,
    user_id VARCHAR(50) REFERENCES users(id),
    session_name VARCHAR(200),
    participating_models JSON, -- 存储参与的模型ID列表
    chat_strategy_id VARCHAR(50) REFERENCES chat_strategies(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 🎯 成功指标

**功能指标**
- [ ] 支持至少3种不同API提供商
- [ ] 群聊模式支持最多5个模型同时对话
- [ ] 模型切换响应时间<200ms
- [ ] API调用成功率>99%

**用户体验指标**  
- [ ] 界面操作简洁直观，学习成本低
- [ ] 配置保存可靠，重启后状态保持
- [ ] 错误提示清晰，故障恢复能力强
- [ ] 群聊消息展示清晰，不产生混淆

**技术指标**
- [ ] 代码结构清晰，易于扩展新的API提供商
- [ ] 数据库设计合理，支持功能快速迭代
- [ ] API响应时间和并发性能满足使用需求
- [ ] 系统稳定性和容错能力达到生产标准

