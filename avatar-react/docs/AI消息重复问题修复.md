# AIæ¶ˆæ¯é‡å¤é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜åˆ†æ

AIæ¶ˆæ¯å‡ºç°é‡å¤çš„æ ¹æœ¬åŸå› ï¼š

### 1. å¤šä¸ªæ¶ˆæ¯æº
- **ChatPanel**: å¤„ç†å•èŠå“åº”æ—¶æ·»åŠ AIæ¶ˆæ¯
- **GroupChatMessages**: ç›‘å¬äº‹ä»¶æ—¶æ·»åŠ æ¶ˆæ¯åˆ°æœ¬åœ°çŠ¶æ€  
- **Redux sendMessage thunk**: é€šè¿‡äº‹ä»¶ç³»ç»Ÿæ·»åŠ æ¶ˆæ¯
- **äº‹ä»¶ç›‘å¬å™¨**: å¤šä¸ªç»„ä»¶ç›‘å¬ç›¸åŒäº‹ä»¶

### 2. æ—¶åºé—®é¢˜
- æ¶ˆæ¯åˆ›å»ºå’Œäº‹ä»¶è§¦å‘çš„æ—¶åºä¸ä¸€è‡´
- å¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶è¿›è¡Œ
- ç¼ºä¹ç»Ÿä¸€çš„æ¶ˆæ¯å»é‡æœºåˆ¶

## ä¿®å¤æ–¹æ¡ˆ

### 1. å¢å¼ºReduxé‡å¤æ£€æµ‹ âœ…

```typescript
// æ›´ä¸¥æ ¼çš„AIæ¶ˆæ¯é‡å¤æ£€æµ‹
if (action.payload.role === 'assistant') {
  // å®Œå…¨ç›¸åŒå†…å®¹ç›´æ¥è®¤ä¸ºé‡å¤
  if (contentMatch) return true;
  
  // å†…å®¹ç›¸ä¼¼æ€§æ£€æµ‹ï¼ˆå­é›†å…³ç³» + é•¿åº¦ç›¸ä¼¼ï¼‰
  const isSubset = content1.includes(content2) || content2.includes(content1);
  const similarLength = lengthDiff < Math.min(content1.length, content2.length) * 0.1;
  
  // åŒä¸€AIåœ¨çŸ­æ—¶é—´å†…çš„é‡å¤å›å¤
  return timeMatch && providerMatch && modelMatch;
}
```

### 2. ChatPanelæ¶ˆæ¯å»é‡ âœ…

```typescript
// åœ¨æ·»åŠ AIæ¶ˆæ¯å‰æ£€æŸ¥é‡å¤
const existingAiMessage = messages.find(msg => 
  msg.role === 'assistant' && 
  msg.content === aiContent &&
  Math.abs((msg.timestamp || 0) - Date.now()) < 5000
);

if (existingAiMessage) {
  console.log('æ£€æµ‹åˆ°é‡å¤çš„AIæ¶ˆæ¯ï¼Œè·³è¿‡æ·»åŠ ');
  return;
}
```

### 3. å”¯ä¸€IDç”Ÿæˆ âœ…

```typescript
// ç”Ÿæˆæ›´å”¯ä¸€çš„æ¶ˆæ¯ID
const aiMessageId = `ai_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤ï¼š

1. **æ¸…é™¤å†å²æ¶ˆæ¯**
   - ç‚¹å‡»"æ¸…é™¤æ¶ˆæ¯"æŒ‰é’®æ¸…ç†é‡å¤æ¶ˆæ¯

2. **å‘é€æµ‹è¯•æ¶ˆæ¯**
   - å‘é€ä¸€æ¡æ–°æ¶ˆæ¯
   - è§‚å¯ŸAIå›å¤æ˜¯å¦åªå‡ºç°ä¸€æ¬¡

3. **å¿«é€Ÿè¿ç»­å‘é€**
   - å¿«é€Ÿå‘é€å¤šæ¡ç›¸åŒæ¶ˆæ¯
   - éªŒè¯å»é‡æœºåˆ¶æ˜¯å¦ç”Ÿæ•ˆ

4. **ç¾¤èŠæ¨¡å¼æµ‹è¯•**
   - åˆ‡æ¢åˆ°ç¾¤èŠæ¨¡å¼
   - éªŒè¯å¤šä¸ªAIå›å¤ä¸ä¼šé‡å¤

### é¢„æœŸæ•ˆæœï¼š

- âœ… ç”¨æˆ·æ¶ˆæ¯ä¸é‡å¤
- âœ… AIå›å¤åªå‡ºç°ä¸€æ¬¡
- âœ… ç¾¤èŠä¸­æ¯ä¸ªAIåªå›å¤ä¸€æ¬¡
- âœ… è¾“å…¥æ¡†å“åº”æµç•…
- âœ… å‘é€æŒ‰é’®å±…ä¸­å¯¹é½

## è°ƒè¯•ä¿¡æ¯

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼š

```javascript
// æŸ¥çœ‹æ¶ˆæ¯æ·»åŠ æ—¥å¿—
ğŸ” ChatPanel: æ£€æµ‹åˆ°é‡å¤çš„AIæ¶ˆæ¯ï¼Œè·³è¿‡æ·»åŠ 
ğŸ” æ£€æµ‹åˆ°é‡å¤çš„assistantæ¶ˆæ¯ï¼Œè·³è¿‡æ·»åŠ : [å†…å®¹é¢„è§ˆ]...

// æŸ¥çœ‹ReduxçŠ¶æ€
console.log('å½“å‰æ¶ˆæ¯åˆ—è¡¨:', store.getState().chat.messages);
```

## æ€§èƒ½ä¼˜åŒ–

- **æ—¶é—´çª—å£**: é‡å¤æ£€æµ‹æ—¶é—´çª—å£è®¾ä¸º10ç§’
- **å†…å®¹ç›¸ä¼¼åº¦**: 10%é•¿åº¦å·®å¼‚å®¹å¿åº¦
- **æ£€æŸ¥èŒƒå›´**: åªæ£€æŸ¥æœ€è¿‘5æ¡åŒç±»å‹æ¶ˆæ¯
- **IDå”¯ä¸€æ€§**: æ—¶é—´æˆ³ + éšæœºå­—ç¬¦ä¸²ç¡®ä¿å”¯ä¸€

## åç»­ç›‘æ§

å»ºè®®æŒç»­ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
- æ¶ˆæ¯é‡å¤ç‡
- ç”¨æˆ·ä½“éªŒåé¦ˆ
- æ§åˆ¶å°é”™è¯¯æ—¥å¿—
- å†…å­˜ä½¿ç”¨æƒ…å†µ

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-01-17 23:00
**ä¿®å¤ç‰ˆæœ¬**: v1.2.0
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡