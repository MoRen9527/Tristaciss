# 群聊功能测试用例

## 测试环境准备

### 前置条件
1. 后端服务正常运行 (http://localhost:8000)
2. 前端服务正常运行 (http://localhost:3000)
3. 至少配置2个可用的AI模型
4. WebSocket连接正常

### 测试数据
- 测试用户消息: "你好，请介绍一下你们自己"
- 统一系统提示词: "你们可以自己给自己一个角色，性格随机自选，参与这场群聊讨论"
- 个性化提示词示例:
  - GPT-4: "你是一个医生，性格温和，参与这场群聊讨论"
  - Claude: "你是一个老师，性格严谨，参与这场群聊讨论"

## 基础功能测试

### TC001: 群聊页面加载测试
**测试目的**: 验证群聊页面能够正常加载
**测试步骤**:
1. 访问群聊页面 `/group-chat`
2. 检查页面标题是否正确
3. 检查模型选择对话框是否自动弹出
**预期结果**: 
- 页面正常加载
- 显示"选择群聊参与的大模型"对话框
- 对话框包含可用模型列表

### TC002: 模型选择功能测试
**测试目的**: 验证用户可以选择多个AI模型
**测试步骤**:
1. 在模型选择对话框中点击至少2个模型
2. 检查选中状态是否正确显示
3. 检查"开始群聊"按钮状态
**预期结果**:
- 选中的模型显示选中状态
- 按钮文本显示"开始群聊 (N 个模型)"
- 按钮变为可点击状态

### TC003: 系统提示词配置测试
**测试目的**: 验证系统提示词配置功能
**测试步骤**:
1. 选择"统一配置"模式
2. 输入统一系统提示词
3. 切换到"个性化配置"模式
4. 为每个选中模型输入不同的提示词
**预期结果**:
- 两种配置模式可以正常切换
- 输入框正常显示和接受输入
- 个性化模式下每个模型都有独立的输入框

### TC004: WebSocket连接建立测试
**测试目的**: 验证WebSocket连接能够正常建立
**测试步骤**:
1. 完成模型选择和配置
2. 点击"开始群聊"按钮
3. 检查连接状态指示器
4. 检查浏览器开发者工具中的WebSocket连接
**预期结果**:
- 对话框关闭，显示群聊界面
- 没有显示连接断开警告
- 开发者工具显示WebSocket连接已建立

## 核心功能测试

### TC005: 消息发送测试
**测试目的**: 验证用户可以发送消息
**测试步骤**:
1. 在消息输入框中输入测试消息
2. 点击发送按钮或按Enter键
3. 检查消息是否显示在聊天界面
**预期结果**:
- 消息立即显示在聊天界面右侧
- 消息显示用户头像和时间戳
- 输入框清空

### TC006: AI模型响应测试
**测试目的**: 验证AI模型能够接收并响应消息
**测试步骤**:
1. 发送测试消息
2. 等待AI模型响应
3. 检查响应消息的显示
4. 验证多个模型都有响应
**预期结果**:
- 所有选中的模型都产生响应
- 响应消息显示在聊天界面左侧
- 每个响应显示对应的模型名称和头像
- 响应按照接收顺序显示

### TC007: 上下文显示测试
**测试目的**: 验证上下文信息正确显示
**测试步骤**:
1. 发送消息并等待响应
2. 检查头部的上下文大小显示
3. 检查各模型的上下文使用率
**预期结果**:
- 显示"共享上下文大小: X tokens"
- 每个模型显示独立的上下文使用率进度条
- 数值随着对话进行而更新

### TC008: 模型状态显示测试
**测试目的**: 验证模型状态正确显示
**测试步骤**:
1. 观察模型状态芯片的颜色变化
2. 检查鼠标悬停时的提示信息
**预期结果**:
- 模型处理中时显示相应状态
- 模型活跃时显示primary颜色
- 悬停显示详细状态信息

## 高级功能测试

### TC009: 统一系统提示词模式测试
**测试目的**: 验证统一系统提示词模式工作正常
**测试步骤**:
1. 选择统一配置模式
2. 设置统一提示词
3. 开始群聊并发送消息
4. 观察AI响应是否符合提示词要求
**预期结果**:
- 所有AI模型的响应都体现统一提示词的要求
- 模型表现出相似的角色特征

### TC010: 个性化系统提示词模式测试
**测试目的**: 验证个性化系统提示词模式工作正常
**测试步骤**:
1. 选择个性化配置模式
2. 为不同模型设置不同的提示词
3. 开始群聊并发送消息
4. 观察AI响应是否符合各自的提示词
**预期结果**:
- 不同AI模型表现出不同的角色特征
- 响应内容符合各自的提示词设定

### TC011: 重新配置功能测试
**测试目的**: 验证可以重新配置模型选择
**测试步骤**:
1. 在群聊界面点击"重新配置"按钮
2. 修改模型选择或提示词配置
3. 确认配置并继续群聊
**预期结果**:
- 模型选择对话框重新打开
- 可以修改之前的配置
- 新配置生效，群聊继续进行

### TC012: 长对话上下文管理测试
**测试目的**: 验证长对话的上下文管理
**测试步骤**:
1. 连续发送多条消息（超过20条）
2. 观察上下文大小变化
3. 检查模型响应质量是否保持
**预期结果**:
- 上下文大小合理控制
- 过长的历史记录被适当裁剪
- 模型响应质量保持稳定

## 边界情况测试

### TC013: 网络断开处理测试
**测试目的**: 验证网络断开时的处理机制
**测试步骤**:
1. 在群聊过程中断开网络连接
2. 观察界面提示
3. 恢复网络连接
4. 检查自动重连功能
**预期结果**:
- 显示"WebSocket连接已断开，正在尝试重连..."警告
- 网络恢复后自动重连成功
- 群聊功能恢复正常

### TC014: 模型响应失败处理测试
**测试目的**: 验证模型响应失败时的处理
**测试步骤**:
1. 模拟某个模型服务不可用
2. 发送消息
3. 观察错误处理
**预期结果**:
- 失败的模型显示错误状态
- 其他正常模型继续响应
- 显示友好的错误提示

### TC015: 空消息处理测试
**测试目的**: 验证空消息的处理
**测试步骤**:
1. 尝试发送空消息
2. 尝试发送只包含空格的消息
**预期结果**:
- 空消息不会被发送
- 发送按钮保持禁用状态

### TC016: 特殊字符处理测试
**测试目的**: 验证特殊字符的处理
**测试步骤**:
1. 发送包含特殊字符的消息（如emoji、换行符等）
2. 检查消息显示是否正确
**预期结果**:
- 特殊字符正确显示
- 换行符保持格式
- emoji正常显示

### TC017: 大量并发消息测试
**测试目的**: 验证大量并发消息的处理能力
**测试步骤**:
1. 快速连续发送多条消息
2. 观察系统响应
3. 检查消息顺序和完整性
**预期结果**:
- 所有消息都能正确处理
- 响应顺序符合预期
- 系统保持稳定

## 性能测试

### TC018: 响应时间测试
**测试目的**: 验证系统响应时间符合要求
**测试步骤**:
1. 记录消息发送时间
2. 记录第一个AI回复时间
3. 计算响应时间
**预期结果**:
- 用户消息到第一个AI回复 < 3秒
- 界面响应流畅，无明显卡顿

### TC019: 内存使用测试
**测试目的**: 验证内存使用在合理范围内
**测试步骤**:
1. 使用浏览器开发者工具监控内存使用
2. 进行长时间对话
3. 检查内存增长情况
**预期结果**:
- 内存使用保持稳定
- 没有明显的内存泄漏
- 长时间使用后内存使用合理

### TC020: 多模型并发性能测试
**测试目的**: 验证多模型并发处理性能
**测试步骤**:
1. 选择最大数量的模型（如10个）
2. 发送消息并观察响应
3. 检查系统负载
**预期结果**:
- 所有模型都能正常响应
- 系统保持稳定
- 响应时间在可接受范围内

## 用户体验测试

### TC021: 响应式设计测试
**测试目的**: 验证不同屏幕尺寸下的显示效果
**测试步骤**:
1. 在不同屏幕尺寸下测试界面
2. 检查布局适应性
3. 验证功能完整性
**预期结果**:
- 界面在不同尺寸下正常显示
- 所有功能都可正常使用
- 文字和按钮大小合适

### TC022: 键盘快捷键测试
**测试目的**: 验证键盘快捷键功能
**测试步骤**:
1. 使用Enter键发送消息
2. 使用Shift+Enter换行
3. 测试其他快捷键
**预期结果**:
- Enter键正常发送消息
- Shift+Enter正常换行
- 快捷键响应及时

### TC023: 加载状态测试
**测试目的**: 验证加载状态指示器
**测试步骤**:
1. 观察消息发送时的加载状态
2. 检查模型响应时的状态指示
**预期结果**:
- 发送消息时显示加载指示器
- 模型处理时显示相应状态
- 状态变化及时准确

## 兼容性测试

### TC024: 浏览器兼容性测试
**测试目的**: 验证不同浏览器的兼容性
**测试步骤**:
1. 在Chrome、Firefox、Safari、Edge中测试
2. 检查功能完整性
3. 验证WebSocket支持
**预期结果**:
- 所有主流浏览器都能正常使用
- WebSocket连接正常建立
- 功能表现一致

### TC025: 设备兼容性测试
**测试目的**: 验证不同设备的兼容性
**测试步骤**:
1. 在桌面、平板、手机上测试
2. 检查触摸操作
3. 验证界面适应性
**预期结果**:
- 不同设备都能正常使用
- 触摸操作响应正常
- 界面适应不同设备

## 测试执行计划

### 自动化测试
- 使用Playwright执行基础功能测试（TC001-TC012）
- 自动化边界情况测试（TC013-TC017）
- 性能基准测试（TC018-TC020）

### 手动测试
- 用户体验测试（TC021-TC023）
- 兼容性测试（TC024-TC025）
- 探索性测试

### 测试环境
- 开发环境：本地开发服务器
- 测试环境：模拟生产环境
- 生产环境：实际部署环境

### 测试数据管理
- 准备多种类型的测试消息
- 配置不同的AI模型组合
- 模拟各种网络条件

### 缺陷管理
- 使用统一的缺陷跟踪系统
- 按优先级分类处理
- 回归测试验证修复效果

## 验收标准

### 功能完整性
- 所有核心功能正常工作
- 边界情况得到妥善处理
- 错误处理机制完善

### 性能要求
- 响应时间满足要求
- 内存使用合理
- 并发处理能力达标

### 用户体验
- 界面友好直观
- 操作流畅自然
- 错误提示清晰

### 稳定性
- 长时间运行稳定
- 异常情况恢复正常
- 数据一致性保证

通过以上测试用例的执行，可以全面验证群聊功能的质量和可靠性，确保为用户提供优质的多模型对话体验。